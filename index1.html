<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESP01 Röle Kontrol Paneli</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Arial, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 14px;
        }
        
        .wifi-status {
            background: #f8f9fa;
            padding: 20px;
            margin: 20px;
            border-radius: 15px;
            border-left: 5px solid #667eea;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .wifi-status h3 {
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .wifi-status h3 i {
            color: #667eea;
        }
        
        .signal-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .signal-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
        }
        
        .signal-item .label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .signal-item .value {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }
        
        .signal-bar-container {
            margin-top: 10px;
            height: 10px;
            background: #e9ecef;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .signal-bar {
            height: 100%;
            background: linear-gradient(90deg, #ff4444, #ffbb33, #00C851);
            border-radius: 5px;
            transition: width 0.5s ease;
        }
        
        .signal-quality {
            margin-top: 10px;
            font-size: 14px;
            padding: 5px 10px;
            border-radius: 20px;
            display: inline-block;
            font-weight: 500;
        }
        
        .quality-excellent { background: #d4edda; color: #155724; }
        .quality-good { background: #fff3cd; color: #856404; }
        .quality-poor { background: #f8d7da; color: #721c24; }
        
        .relay-controls {
            padding: 20px;
        }
        
        .section-title {
            color: #333;
            margin: 20px 0 15px 0;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
            font-size: 20px;
        }
        
        .relay-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .relay-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }
        
        .relay-card:hover {
            border-color: #667eea;
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.2);
        }
        
        .relay-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .relay-title {
            font-size: 22px;
            font-weight: 600;
            color: #333;
        }
        
        .relay-status {
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 14px;
        }
        
        .status-on { background: #d4edda; color: #155724; }
        .status-off { background: #f8d7da; color: #721c24; }
        
        .control-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }
        
        .btn {
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-on {
            background: linear-gradient(135deg, #00C851, #007E33);
            color: white;
        }
        
        .btn-off {
            background: linear-gradient(135deg, #ff4444, #CC0000);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn i {
            font-size: 18px;
        }
        
        .schedule-control {
            padding: 20px;
            background: #f8f9fa;
            margin: 20px;
            border-radius: 15px;
        }
        
        .schedule-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            transition: border 0.3s ease;
        }
        
        .form-control:focus {
            border-color: #667eea;
            outline: none;
        }
        
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }
        
        .btn-save {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            width: 100%;
            transition: all 0.3s ease;
        }
        
        .btn-save:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .device-info {
            background: #333;
            color: white;
            padding: 20px;
            margin-top: 20px;
            border-radius: 15px;
        }
        
        .device-info h3 {
            margin-bottom: 15px;
            color: #fff;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .info-item {
            background: rgba(255,255,255,0.1);
            padding: 12px;
            border-radius: 8px;
        }
        
        .info-label {
            font-size: 12px;
            opacity: 0.8;
            margin-bottom: 5px;
        }
        
        .info-value {
            font-family: 'Courier New', monospace;
            font-size: 14px;
            word-break: break-all;
        }
        
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #333;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            display: none;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .footer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 14px;
            border-top: 1px solid #eee;
        }
        
        @media (max-width: 600px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }
            
            .header {
                padding: 20px;
            }
            
            .relay-cards {
                grid-template-columns: 1fr;
            }
            
            .control-buttons {
                grid-template-columns: 1fr;
            }
            
            .wifi-status, .relay-controls, .schedule-control {
                padding: 15px;
                margin: 10px;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- Başlık -->
        <div class="header">
            <h1><i class="fas fa-microchip"></i> ESP01 Röle Kontrol Paneli</h1>
            <p>WiFi ve MQTT ile Akıllı Röle Kontrolü</p>
        </div>
        
        <!-- WiFi Sinyal Durumu -->
        <div class="wifi-status">
            <h3><i class="fas fa-wifi"></i> WiFi Sinyal Durumu</h3>
            <div class="signal-info">
                <div class="signal-item">
                    <div class="label">Sinyal Gücü (RSSI)</div>
                    <div class="value" id="rssiValue">-- dBm</div>
                    <div class="signal-bar-container">
                        <div class="signal-bar" id="signalBar"></div>
                    </div>
                </div>
                <div class="signal-item">
                    <div class="label">Sinyal Kalitesi</div>
                    <div class="value" id="signalPercent">--%</div>
                    <div class="signal-quality" id="signalQuality">Yükleniyor...</div>
                </div>
                <div class="signal-item">
                    <div class="label">IP Adresi</div>
                    <div class="value" id="ipAddress">--</div>
                    <div class="label" style="margin-top: 10px;">MAC Adresi</div>
                    <div class="value" style="font-size: 18px;" id="macAddress">--</div>
                </div>
            </div>
        </div>
        
        <!-- Röle Kontrolleri -->
        <div class="relay-controls">
            <div class="section-title"><i class="fas fa-sliders-h"></i> Röle Kontrolleri</div>
            <div class="relay-cards">
                <!-- Röle 1 -->
                <div class="relay-card" id="relay1Card">
                    <div class="relay-header">
                        <div class="relay-title"><i class="fas fa-lightbulb"></i> Röle 1</div>
                        <div class="relay-status status-off" id="relay1Status">KAPALI</div>
                    </div>
                    <div class="control-buttons">
                        <button class="btn btn-on" onclick="controlRelay(1, 'on')">
                            <i class="fas fa-power-off"></i> AÇ
                        </button>
                        <button class="btn btn-off" onclick="controlRelay(1, 'off')">
                            <i class="fas fa-power-off"></i> KAPAT
                        </button>
                    </div>
                    <div class="form-group">
                        <label>Manuel Zaman Aşımı (saat)</label>
                        <select class="form-control" id="overrideTime1" onchange="setOverrideTime(1, this.value)">
                            <option value="1">1 Saat</option>
                            <option value="2">2 Saat</option>
                            <option value="4">4 Saat</option>
                            <option value="8">8 Saat</option>
                            <option value="24">1 Gün</option>
                            <option value="0">Süresiz</option>
                        </select>
                    </div>
                </div>
                
                <!-- Röle 2 -->
                <div class="relay-card" id="relay2Card">
                    <div class="relay-header">
                        <div class="relay-title"><i class="fas fa-lightbulb"></i> Röle 2</div>
                        <div class="relay-status status-off" id="relay2Status">KAPALI</div>
                    </div>
                    <div class="control-buttons">
                        <button class="btn btn-on" onclick="controlRelay(2, 'on')">
                            <i class="fas fa-power-off"></i> AÇ
                        </button>
                        <button class="btn btn-off" onclick="controlRelay(2, 'off')">
                            <i class="fas fa-power-off"></i> KAPAT
                        </button>
                    </div>
                    <div class="form-group">
                        <label>Manuel Zaman Aşımı (saat)</label>
                        <select class="form-control" id="overrideTime2" onchange="setOverrideTime(2, this.value)">
                            <option value="1">1 Saat</option>
                            <option value="2">2 Saat</option>
                            <option value="4">4 Saat</option>
                            <option value="8">8 Saat</option>
                            <option value="24">1 Gün</option>
                            <option value="0">Süresiz</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Zamanlama Ayarları -->
        <div class="schedule-control">
            <div class="section-title"><i class="fas fa-clock"></i> Zamanlama Ayarları</div>
            
            <!-- Röle 1 Zamanlama -->
            <div class="relay-card" style="margin-bottom: 20px;">
                <div class="relay-title" style="margin-bottom: 15px;"><i class="fas fa-calendar-alt"></i> Röle 1 Zamanlama</div>
                <div class="schedule-form">
                    <div class="form-group">
                        <label>Başlangıç Saati</label>
                        <input type="time" class="form-control" id="startTime1" value="08:00">
                    </div>
                    <div class="form-group">
                        <label>Bitiş Saati</label>
                        <input type="time" class="form-control" id="endTime1" value="18:00">
                    </div>
                    <div class="form-group">
                        <label>Günler</label>
                        <div class="checkbox-group" id="days1">
                            <label class="checkbox-item"><input type="checkbox" value="1" checked> Pazartesi</label>
                            <label class="checkbox-item"><input type="checkbox" value="2" checked> Salı</label>
                            <label class="checkbox-item"><input type="checkbox" value="4" checked> Çarşamba</label>
                            <label class="checkbox-item"><input type="checkbox" value="8" checked> Perşembe</label>
                            <label class="checkbox-item"><input type="checkbox" value="16" checked> Cuma</label>
                            <label class="checkbox-item"><input type="checkbox" value="32" checked> Cumartesi</label>
                            <label class="checkbox-item"><input type="checkbox" value="64" checked> Pazar</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="active1" checked> Zamanlamayı Aktif Et
                        </label>
                    </div>
                    <button class="btn-save" onclick="saveSchedule(1)">
                        <i class="fas fa-save"></i> Röle 1 Zamanlamasını Kaydet
                    </button>
                </div>
            </div>
            
            <!-- Röle 2 Zamanlama -->
            <div class="relay-card">
                <div class="relay-title" style="margin-bottom: 15px;"><i class="fas fa-calendar-alt"></i> Röle 2 Zamanlama</div>
                <div class="schedule-form">
                    <div class="form-group">
                        <label>Başlangıç Saati</label>
                        <input type="time" class="form-control" id="startTime2" value="08:00">
                    </div>
                    <div class="form-group">
                        <label>Bitiş Saati</label>
                        <input type="time" class="form-control" id="endTime2" value="18:00">
                    </div>
                    <div class="form-group">
                        <label>Günler</label>
                        <div class="checkbox-group" id="days2">
                            <label class="checkbox-item"><input type="checkbox" value="1" checked> Pazartesi</label>
                            <label class="checkbox-item"><input type="checkbox" value="2" checked> Salı</label>
                            <label class="checkbox-item"><input type="checkbox" value="4" checked> Çarşamba</label>
                            <label class="checkbox-item"><input type="checkbox" value="8" checked> Perşembe</label>
                            <label class="checkbox-item"><input type="checkbox" value="16" checked> Cuma</label>
                            <label class="checkbox-item"><input type="checkbox" value="32" checked> Cumartesi</label>
                            <label class="checkbox-item"><input type="checkbox" value="64" checked> Pazar</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="active2" checked> Zamanlamayı Aktif Et
                        </label>
                    </div>
                    <button class="btn-save" onclick="saveSchedule(2)">
                        <i class="fas fa-save"></i> Röle 2 Zamanlamasını Kaydet
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Cihaz Bilgileri -->
        <div class="device-info">
            <h3><i class="fas fa-info-circle"></i> Cihaz Bilgileri</h3>
            <div class="info-grid">
                <div class="info-item">
                    <div class="info-label">MQTT Server</div>
                    <div class="info-value" id="mqttServer">--</div>
                </div>
                <div class="info-item">
                    <div class="info-label">MQTT Port</div>
                    <div class="info-value" id="mqttPort">--</div>
                </div>
                <div class="info-item">
                    <div class="info-label">R1 Set Topic</div>
                    <div class="info-value" id="topicR1Set">--</div>
                </div>
                <div class="info-item">
                    <div class="info-label">R2 Set Topic</div>
                    <div class="info-value" id="topicR2Set">--</div>
                </div>
            </div>
            <div style="margin-top: 15px; display: flex; gap: 10px;">
                <button class="btn" onclick="showToast('Topikler yükleniyor...'); loadTopics();" 
                        style="background: #667eea; color: white; padding: 10px 20px; border-radius: 8px;">
                    <i class="fas fa-sync-alt"></i> Topikleri Yenile
                </button>
                <button class="btn" onclick="showToast('EEPROM temizleniyor...'); clearEEPROM();" 
                        style="background: #ff4444; color: white; padding: 10px 20px; border-radius: 8px;">
                    <i class="fas fa-trash"></i> EEPROM Temizle
                </button>
                <button class="btn" onclick="showToast('WiFi ayarları sıfırlanıyor...'); resetWiFi();" 
                        style="background: #ffbb33; color: white; padding: 10px 20px; border-radius: 8px;">
                    <i class="fas fa-redo"></i> WiFi Sıfırla
                </button>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="footer">
            <p>© 2024 ESP01 Röle Kontrol Sistemi | v2.4</p>
            <p>Son Güncelleme: <span id="lastUpdate">--</span></p>
        </div>
    </div>
    
    <!-- Toast Mesaj -->
    <div class="toast" id="toast"></div>

    <script>
        // Değişkenler
        let overrideTimes = {1: 3600, 2: 3600}; // Varsayılan 1 saat
        let lastStatus = {};
        
        // Sayfa yüklendiğinde çalışacak fonksiyon
        document.addEventListener('DOMContentLoaded', function() {
            // İlk durumu yükle
            updateStatus();
            loadDeviceInfo();
            loadMACAddress();
            
            // Her 2 saniyede bir durumu güncelle
            setInterval(updateStatus, 2000);
            
            // Her 10 saniyede bir WiFi sinyalini güncelle
            setInterval(updateSignalInfo, 10000);
            
            // Son güncelleme zamanını göster
            document.getElementById('lastUpdate').textContent = new Date().toLocaleString('tr-TR');
        });
        
        // Röle kontrol fonksiyonu
        function controlRelay(relayId, action) {
            showToast(`Röle ${relayId} ${action === 'on' ? 'açılıyor' : 'kapatılıyor'}...`);
            
            fetch(`/control?id=${relayId}&action=${action}`)
                .then(response => response.text())
                .then(data => {
                    if (data === 'OK') {
                        showToast(`Röle ${relayId} başarıyla ${action === 'on' ? 'açıldı' : 'kapatıldı'}`);
                        updateStatus();
                    } else {
                        showToast('Hata: ' + data, 'error');
                    }
                })
                .catch(error => {
                    console.error('Hata:', error);
                    showToast('Bağlantı hatası!', 'error');
                });
        }
        
        // Manuel zaman aşımı ayarı
        function setOverrideTime(relayId, hours) {
            overrideTimes[relayId] = parseInt(hours) * 3600; // Saati saniyeye çevir
            showToast(`Röle ${relayId} manuel zaman aşımı: ${hours} saat`);
            
            // Eğer 0 saat seçildiyse, süresiz yap
            if (hours === '0') {
                overrideTimes[relayId] = 0;
                showToast(`Röle ${relayId} süresiz manuel kontrol`);
            }
        }
        
        // Zamanlama kaydetme
        function saveSchedule(relayId) {
            const startTime = document.getElementById(`startTime${relayId}`).value;
            const endTime = document.getElementById(`endTime${relayId}`).value;
            const active = document.getElementById(`active${relayId}`).checked ? 1 : 0;
            
            // Günleri hesapla
            let days = 0;
            const checkboxes = document.querySelectorAll(`#days${relayId} input[type="checkbox"]:checked`);
            checkboxes.forEach(cb => {
                days += parseInt(cb.value);
            });
            
            if (days === 0) {
                showToast('En az bir gün seçmelisiniz!', 'error');
                return;
            }
            
            const [startH, startM] = startTime.split(':');
            const [endH, endM] = endTime.split(':');
            
            const params = new URLSearchParams({
                relay_id: relayId,
                start_h: startH,
                start_m: startM,
                end_h: endH,
                end_m: endM,
                days: days,
                active: active
            });
            
            showToast(`Röle ${relayId} zamanlaması kaydediliyor...`);
            
            fetch(`/save?${params}`)
                .then(response => response.text())
                .then(data => {
                    if (data === 'OK') {
                        showToast(`Röle ${relayId} zamanlaması başarıyla kaydedildi!`);
                        updateStatus();
                    } else {
                        showToast('Hata: ' + data, 'error');
                    }
                })
                .catch(error => {
                    console.error('Hata:', error);
                    showToast('Bağlantı hatası!', 'error');
                });
        }
        
        // Durum güncelleme
        function updateStatus() {
            fetch('/status')
                .then(response => response.json())
                .then(data => {
                    // Röle durumlarını güncelle
                    updateRelayStatus(1, data);
                    updateRelayStatus(2, data);
                    
                    // WiFi sinyal bilgisi varsa güncelle
                    if (data.wifi_rssi !== undefined) {
                        updateSignalInfoFromData(data);
                    }
                    
                    // Zamanlama bilgilerini güncelle
                    if (data.sched_start_r1) {
                        document.getElementById('startTime1').value = data.sched_start_r1;
                        document.getElementById('endTime1').value = data.sched_end_r1;
                        document.getElementById('active1').checked = data.sched_active_r1 === 'true';
                    }
                    
                    if (data.sched_start_r2) {
                        document.getElementById('startTime2').value = data.sched_start_r2;
                        document.getElementById('endTime2').value = data.sched_end_r2;
                        document.getElementById('active2').checked = data.sched_active_r2 === 'true';
                    }
                    
                    lastStatus = data;
                })
                .catch(error => {
                    console.error('Durum güncelleme hatası:', error);
                });
        }
        
        // Röle durumunu güncelle
        function updateRelayStatus(relayId, data) {
            const stateKey = `r${relayId}_state`;
            const activeKey = `sched_active_r${relayId}`;
            
            if (data[stateKey]) {
                const isOn = data[stateKey] === 'ON';
                const statusElement = document.getElementById(`relay${relayId}Status`);
                const cardElement = document.getElementById(`relay${relayId}Card`);
                
                // Durum metni ve rengi
                statusElement.textContent = isOn ? 'AÇIK' : 'KAPALI';
                statusElement.className = `relay-status ${isOn ? 'status-on' : 'status-off'}`;
                
                // Kart arka plan rengi
                cardElement.style.borderColor = isOn ? '#00C851' : '#ff4444';
                
                // Zamanlama aktif mi?
                if (data[activeKey] === 'true') {
                    statusElement.innerHTML += ' <small>(Zamanlama Aktif)</small>';
                }
            }
        }
        
        // WiFi sinyal bilgisini güncelle
        function updateSignalInfo() {
            fetch('/status')
                .then(response => response.json())
                .then(data => {
                    if (data.wifi_rssi !== undefined) {
                        updateSignalInfoFromData(data);
                    }
                })
                .catch(error => {
                    console.error('Sinyal bilgisi hatası:', error);
                });
        }
        
        // Data'dan sinyal bilgisi güncelleme
        function updateSignalInfoFromData(data) {
            const rssi = data.wifi_rssi;
            if (rssi === undefined) return;
            
            // RSSI değerini göster
            document.getElementById('rssiValue').textContent = `${rssi} dBm`;
            
            // Sinyal gücünü yüzde olarak hesapla
            let signalPercent = 0;
            let qualityText = '';
            let qualityClass = '';
            
            if (rssi >= -50) {
                signalPercent = 100;
                qualityText = 'MÜKEMMEL';
                qualityClass = 'quality-excellent';
            } else if (rssi >= -60) {
                signalPercent = 80;
                qualityText = 'ÇOK İYİ';
                qualityClass = 'quality-excellent';
            } else if (rssi >= -70) {
                signalPercent = 60;
                qualityText = 'İYİ';
                qualityClass = 'quality-good';
            } else if (rssi >= -80) {
                signalPercent = 40;
                qualityText = 'ORTA';
                qualityClass = 'quality-good';
            } else if (rssi >= -90) {
                signalPercent = 20;
                qualityText = 'ZAYIF';
                qualityClass = 'quality-poor';
            } else {
                signalPercent = 0;
                qualityText = 'ÇOK ZAYIF';
                qualityClass = 'quality-poor';
            }
            
            // Sinyal yüzdesini göster
            document.getElementById('signalPercent').textContent = `${signalPercent}%`;
            
            // Sinyal çubuğunu güncelle
            document.getElementById('signalBar').style.width = `${signalPercent}%`;
            
            // Kalite metnini güncelle
            const qualityElement = document.getElementById('signalQuality');
            qualityElement.textContent = qualityText;
            qualityElement.className = `signal-quality ${qualityClass}`;
            
            // IP adresini göster (status endpoint'inden)
            if (data.ip) {
                document.getElementById('ipAddress').textContent = data.ip;
            }
        }
        
        // MAC adresini yükle
        function loadMACAddress() {
            fetch('/mac')
                .then(response => response.text())
                .then(mac => {
                    document.getElementById('macAddress').textContent = mac;
                })
                .catch(error => {
                    console.error('MAC adresi hatası:', error);
                });
        }
        
        // Cihaz bilgilerini yükle
        function loadDeviceInfo() {
            // Örnek bilgiler - gerçek uygulamada API'den alınacak
            document.getElementById('mqttServer').textContent = 'broker.hivemq.com';
            document.getElementById('mqttPort').textContent = '1883';
            
            // Topikleri yükle
            loadTopics();
        }
        
        // MQTT topiklerini yükle
        function loadTopics() {
            fetch('/topics')
                .then(response => response.text())
                .then(data => {
                    const lines = data.split('\n');
                    lines.forEach(line => {
                        if (line.includes('R1 Set:')) {
                            document.getElementById('topicR1Set').textContent = line.replace('R1 Set: ', '');
                        }
                        if (line.includes('R2 Set:')) {
                            document.getElementById('topicR2Set').textContent = line.replace('R2 Set: ', '');
                        }
                    });
                })
                .catch(error => {
                    console.error('Topik yükleme hatası:', error);
                });
        }
        
        // EEPROM temizleme
        function clearEEPROM() {
            if (confirm('EEPROM temizlenecek. Bu işlem geri alınamaz! Devam etmek istiyor musunuz?')) {
                fetch('/eeprom_clr')
                    .then(response => response.text())
                    .then(data => {
                        showToast(data);
                        setTimeout(() => {
                            showToast('Cihaz yeniden başlatılacak...');
                            setTimeout(() => location.reload(), 2000);
                        }, 3000);
                    })
                    .catch(error => {
                        console.error('EEPROM temizleme hatası:', error);
                        showToast('Hata: ' + error, 'error');
                    });
            }
        }
        
        // WiFi ayarlarını sıfırlama
        function resetWiFi() {
            if (confirm('WiFi ayarları sıfırlanacak ve cihaz yeniden başlatılacak. Devam etmek istiyor musunuz?')) {
                fetch('/wifi_clr')
                    .then(response => response.text())
                    .then(data => {
                        showToast(data);
                    })
                    .catch(error => {
                        console.error('WiFi sıfırlama hatası:', error);
                        showToast('Hata: ' + error, 'error');
                    });
            }
        }
        
        // Toast mesajı göster
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.style.display = 'block';
            toast.style.background = type === 'error' ? '#ff4444' : '#333';
            
            // 3 saniye sonra gizle
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }
        
        // Günleri kontrol kutularına yükle
        function loadDaysToCheckboxes(relayId, daysValue) {
            const days = parseInt(daysValue);
            const checkboxes = document.querySelectorAll(`#days${relayId} input[type="checkbox"]`);
            
            checkboxes.forEach(cb => {
                const value = parseInt(cb.value);
                cb.checked = (days & value) !== 0;
            });
        }
    </script>
</body>
</html>
