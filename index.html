<!DOCTYPE html>
<html lang="tr">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>ESP Kontrol</title>
Â  Â  <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
Â  Â  <style>
Â  Â  Â  Â  * { margin: 0; padding: 0; box-sizing: border-box; }
Â  Â  Â  Â  body { background: #121212; color: #e0e0e0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .container { max-width: 500px; margin: 0 auto; padding: 15px; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .header {Â 
Â  Â  Â  Â  Â  Â  display: flex; justify-content: space-between; align-items: center;
Â  Â  Â  Â  Â  Â  padding: 15px 0; margin-bottom: 15px; border-bottom: 1px solid #333;
Â  Â  Â  Â  }
Â  Â  Â  Â  .header h1 { font-size: 20px; color: #4fc3f7; }
Â  Â  Â  Â  .status { font-size: 12px; padding: 4px 10px; border-radius: 10px; }
Â  Â  Â  Â  .status.connected { background: #2e7d32; color: #fff; }
Â  Â  Â  Â  .status.disconnected { background: #c62828; color: #fff; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .tabs { display: flex; background: #1e1e1e; border-radius: 10px; margin-bottom: 15px; overflow: hidden; }
Â  Â  Â  Â  .tab { flex: 1; padding: 12px; text-align: center; cursor: pointer; font-size: 14px; }
Â  Â  Â  Â  .tab.active { background: #4fc3f7; color: #000; font-weight: 600; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .tab-content { display: none; }
Â  Â  Â  Â  .tab-content.active { display: block; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* Cihaz Listesi */
Â  Â  Â  Â  .device-list { }
Â  Â  Â  Â  .device-card {Â 
Â  Â  Â  Â  Â  Â  background: #1e1e1e; border-radius: 10px; padding: 15px; margin-bottom: 15px;
Â  Â  Â  Â  Â  Â  border-left: 4px solid #4fc3f7;
Â  Â  Â  Â  }
Â  Â  Â  Â  .device-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px; }
Â  Â  Â  Â  .device-name { font-size: 16px; font-weight: 600; }
Â  Â  Â  Â  .device-meta { font-size: 11px; color: #888; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .relay-control { margin: 15px 0; }
Â  Â  Â  Â  .relay-item {Â 
Â  Â  Â  Â  Â  Â  display: flex; justify-content: space-between; align-items: center;
Â  Â  Â  Â  Â  Â  background: #2a2a2a; padding: 12px; border-radius: 8px; margin-bottom: 10px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .relay-info { flex: 1; }
Â  Â  Â  Â  .relay-name { font-size: 14px; margin-bottom: 3px; }
Â  Â  Â  Â  .relay-status { font-size: 12px; }
Â  Â  Â  Â  .relay-status.on { color: #4caf50; }
Â  Â  Â  Â  .relay-status.off { color: #f44336; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .toggle-btn {Â 
Â  Â  Â  Â  Â  Â  width: 60px; height: 32px; border: none; border-radius: 16px;
Â  Â  Â  Â  Â  Â  position: relative; cursor: pointer; transition: all 0.3s;
Â  Â  Â  Â  Â  Â  background: #666;
Â  Â  Â  Â  }
Â  Â  Â  Â  .toggle-btn.on { background: #4caf50; }
Â  Â  Â  Â  .toggle-btn.off { background: #666; }
Â  Â  Â  Â  .toggle-slider {
Â  Â  Â  Â  Â  Â  position: absolute; top: 2px; width: 28px; height: 28px;
Â  Â  Â  Â  Â  Â  border-radius: 50%; background: white; transition: all 0.3s;
Â  Â  Â  Â  }
Â  Â  Â  Â  .toggle-btn.on .toggle-slider { transform: translateX(28px); }
Â  Â  Â  Â  .toggle-btn.off .toggle-slider { transform: translateX(2px); }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .device-actions { display: flex; gap: 8px; margin-top: 15px; }
Â  Â  Â  Â  .action-btn {Â 
Â  Â  Â  Â  Â  Â  flex: 1; padding: 8px; border: none; border-radius: 6px;
Â  Â  Â  Â  Â  Â  font-size: 13px; cursor: pointer;
Â  Â  Â  Â  }
Â  Â  Â  Â  .btn-edit { background: #ff9800; color: #000; }
Â  Â  Â  Â  .btn-delete { background: #f44336; color: #fff; }
Â  Â  Â  Â  .btn-check { background: #9c27b0; color: #fff; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* Form Stilleri */
Â  Â  Â  Â  .form-group { margin-bottom: 15px; }
Â  Â  Â  Â  .form-label { display: block; margin-bottom: 5px; font-size: 14px; color: #aaa; }
Â  Â  Â  Â  .form-input {Â 
Â  Â  Â  Â  Â  Â  width: 100%; padding: 12px; background: #2a2a2a; border: 1px solid #444;
Â  Â  Â  Â  Â  Â  border-radius: 8px; color: #fff; font-size: 14px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .form-input:focus { outline: none; border-color: #4fc3f7; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .form-submit {Â 
Â  Â  Â  Â  Â  Â  width: 100%; padding: 14px; background: #4fc3f7; color: #000;
Â  Â  Â  Â  Â  Â  border: none; border-radius: 8px; font-size: 16px; font-weight: 600;
Â  Â  Â  Â  Â  Â  cursor: pointer; margin-top: 10px;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* Log BÃ¶lÃ¼mÃ¼ */
Â  Â  Â  Â  .log-box {Â 
Â  Â  Â  Â  Â  Â  background: #1e1e1e; border-radius: 10px; padding: 15px;
Â  Â  Â  Â  Â  Â  height: 250px; overflow-y: auto; font-family: 'Courier New', monospace;
Â  Â  Â  Â  Â  Â  font-size: 12px; line-height: 1.4;
Â  Â  Â  Â  }
Â  Â  Â  Â  .log-entry { margin-bottom: 5px; padding-bottom: 5px; border-bottom: 1px solid #333; }
Â  Â  Â  Â  .log-time { color: #888; font-size: 11px; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* Modal */
Â  Â  Â  Â  .modal {Â 
Â  Â  Â  Â  Â  Â  display: none; position: fixed; top: 0; left: 0;
Â  Â  Â  Â  Â  Â  width: 100%; height: 100%; background: rgba(0,0,0,0.8);
Â  Â  Â  Â  Â  Â  z-index: 1000; justify-content: center; align-items: center;
Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .modal-content {Â 
Â  Â  Â  Â  Â  Â  background: #1e1e1e; border-radius: 15px; padding: 20px;
Â  Â  Â  Â  Â  Â  width: 100%; max-width: 400px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .modal-header {Â 
Â  Â  Â  Â  Â  Â  display: flex; justify-content: space-between; align-items: center;
Â  Â  Â  Â  Â  Â  margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #333;
Â  Â  Â  Â  }
Â  Â  Â  Â  .modal-title { font-size: 18px; color: #4fc3f7; }
Â  Â  Â  Â  .modal-close {Â 
Â  Â  Â  Â  Â  Â  background: none; border: none; color: #888; font-size: 24px;
Â  Â  Â  Â  Â  Â  cursor: pointer; line-height: 1;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* Mobil Uyum */
Â  Â  Â  Â  @media (max-width: 480px) {
Â  Â  Â  Â  Â  Â  .container { padding: 10px; }
Â  Â  Â  Â  Â  Â  .device-card { padding: 12px; }
Â  Â  Â  Â  Â  Â  .relay-item { padding: 10px; }
Â  Â  Â  Â  Â  Â  .toggle-btn { width: 55px; height: 30px; }
Â  Â  Â  Â  Â  Â  .toggle-btn.on .toggle-slider { transform: translateX(25px); }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* BoÅŸ Durum */
Â  Â  Â  Â  .empty-state { text-align: center; padding: 40px 20px; color: #666; }
Â  Â  Â  Â  .empty-icon { font-size: 40px; margin-bottom: 10px; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* Alert */
Â  Â  Â  Â  .alert {Â 
Â  Â  Â  Â  Â  Â  padding: 12px; border-radius: 8px; margin-bottom: 15px;
Â  Â  Â  Â  Â  Â  display: none;
Â  Â  Â  Â  }
Â  Â  Â  Â  .alert.show { display: block; animation: fadeIn 0.3s; }
Â  Â  Â  Â  .alert.success { background: rgba(76, 175, 80, 0.2); border: 1px solid #4caf50; }
Â  Â  Â  Â  .alert.error { background: rgba(244, 67, 54, 0.2); border: 1px solid #f44336; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  @keyframes fadeIn {
Â  Â  Â  Â  Â  Â  from { opacity: 0; transform: translateY(-10px); }
Â  Â  Â  Â  Â  Â  to { opacity: 1; transform: translateY(0); }
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body>
Â  Â  <div class="container">
Â  Â  Â  Â  <!-- Header -->
Â  Â  Â  Â  <div class="header">
Â  Â  Â  Â  Â  Â  <h1>ESP Kontrol</h1>
Â  Â  Â  Â  Â  Â  <div id="mqttStatus" class="status disconnected">BaÄŸlantÄ± Yok</div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <!-- Alert -->
Â  Â  Â  Â  <div id="alert" class="alert"></div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <!-- Tabs -->
Â  Â  Â  Â  <div class="tabs">
Â  Â  Â  Â  Â  Â  <div class="tab active" onclick="showTab('devices')">ğŸ“± Cihazlar</div>
Â  Â  Â  Â  Â  Â  <div class="tab" onclick="showTab('add')">â• Ekle</div>
Â  Â  Â  Â  Â  Â  <div class="tab" onclick="showTab('logs')">ğŸ“‹ Loglar</div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <!-- Cihazlar -->
Â  Â  Â  Â  <div id="devices" class="tab-content active">
Â  Â  Â  Â  Â  Â  <div id="deviceList"></div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <!-- Ekle -->
Â  Â  Â  Â  <div id="add" class="tab-content">
Â  Â  Â  Â  Â  Â  <form id="addForm" onsubmit="return addDevice()">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="form-label">Cihaz AdÄ±</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" class="form-input" id="name" required placeholder="Salon LambasÄ±">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="form-label">MAC Adresi</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" class="form-input" id="mac" required placeholder="aabbcc112233">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <small style="color:#666; font-size:12px;">12 karakter, kÃ¼Ã§Ã¼k harf, iki noktasÄ±z</small>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="form-label">IP Adresi (opsiyonel)</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" class="form-input" id="ip" placeholder="192.168.1.100">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" class="form-submit">Kaydet</button>
Â  Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <!-- Loglar -->
Â  Â  Â  Â  <div id="logs" class="tab-content">
Â  Â  Â  Â  Â  Â  <div class="log-box" id="log"></div>
Â  Â  Â  Â  </div>
Â  Â  </div>
Â  Â Â 
Â  Â  <!-- Edit Modal -->
Â  Â  <div id="editModal" class="modal">
Â  Â  Â  Â  <div class="modal-content">
Â  Â  Â  Â  Â  Â  <div class="modal-header">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="modal-title">Cihaz DÃ¼zenle</div>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="modal-close" onclick="closeModal()">Ã—</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <form id="editForm">
Â  Â  Â  Â  Â  Â  Â  Â  <input type="hidden" id="editId">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="form-label">Cihaz AdÄ±</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" class="form-input" id="editName" required>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="form-label">MAC Adresi</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" class="form-input" id="editMac" required>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="form-label">IP Adresi</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" class="form-input" id="editIp">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div style="display:flex; gap:10px; margin-top:20px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" onclick="closeModal()" class="action-btn" style="background:#666;">Ä°ptal</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" onclick="saveEdit()" class="action-btn" style="background:#4fc3f7; color:#000;">Kaydet</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <script>
Â  Â  Â  Â  let mqttClient = null;
Â  Â  Â  Â  let devices = [];
Â  Â  Â  Â Â 
Â  Â  Â  Â  window.onload = function() {
Â  Â  Â  Â  Â  Â  loadDevices();
Â  Â  Â  Â  Â  Â  connectMQTT();
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  function showTab(tabName) {
Â  Â  Â  Â  Â  Â  document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
Â  Â  Â  Â  Â  Â  document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  event.target.classList.add('active');
Â  Â  Â  Â  Â  Â  document.getElementById(tabName).classList.add('active');
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function connectMQTT() {
Â  Â  Â  Â  Â  Â  mqttClient = mqtt.connect('wss://broker.hivemq.com:8884/mqtt');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  mqttClient.on('connect', function() {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('mqttStatus').textContent = 'BaÄŸlandÄ±';
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('mqttStatus').className = 'status connected';
Â  Â  Â  Â  Â  Â  Â  Â  log('MQTT baÄŸlandÄ±');
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  devices.forEach(device => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  subscribeDevice(device);
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  mqttClient.on('message', function(topic, message) {
Â  Â  Â  Â  Â  Â  Â  Â  const msg = message.toString();
Â  Â  Â  Â  Â  Â  Â  Â  log(`MQTT: ${topic} = ${msg}`);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  devices.forEach(device => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (device.mac && topic.includes(device.mac)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (topic.includes('/r1/state')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  device.relays.r1 = msg === '1' ? 'on' : 'off';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if (topic.includes('/r2/state')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  device.relays.r2 = msg === '1' ? 'on' : 'off';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  saveDevices();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderDevices();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  mqttClient.on('error', function(err) {
Â  Â  Â  Â  Â  Â  Â  Â  log(`MQTT hatasÄ±: ${err}`);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function subscribeDevice(device) {
Â  Â  Â  Â  Â  Â  if (!device.mac || !mqttClient) return;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const topics = [
Â  Â  Â  Â  Â  Â  Â  Â  `esp01/${device.mac}/r1/state`,
Â  Â  Â  Â  Â  Â  Â  Â  `esp01/${device.mac}/r2/state`
Â  Â  Â  Â  Â  Â  ];
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  topics.forEach(topic => {
Â  Â  Â  Â  Â  Â  Â  Â  mqttClient.subscribe(topic, function(err) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!err) log(`Abone: ${topic}`);
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function loadDevices() {
Â  Â  Â  Â  Â  Â  const stored = localStorage.getItem('esp01_devices');
Â  Â  Â  Â  Â  Â  if (stored) {
Â  Â  Â  Â  Â  Â  Â  Â  devices = JSON.parse(stored);
Â  Â  Â  Â  Â  Â  Â  Â  renderDevices();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function saveDevices() {
Â  Â  Â  Â  Â  Â  localStorage.setItem('esp01_devices', JSON.stringify(devices));
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function renderDevices() {
Â  Â  Â  Â  Â  Â  const container = document.getElementById('deviceList');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (devices.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="empty-state">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="empty-icon">ğŸ </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>HenÃ¼z cihaz eklenmemiÅŸ</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <small style="color:#666; margin-top:10px;">Yeni cihaz eklemek iÃ§in â• butonuna tÄ±klayÄ±n</small>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  let html = '';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  devices.forEach(device => {
Â  Â  Â  Â  Â  Â  Â  Â  html += `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="device-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="device-header">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="device-name">${device.name}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="device-meta">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${device.mac}<br>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${device.ip ? device.ip : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="relay-control">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="relay-item">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="relay-info">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="relay-name">RÃ¶le 1</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="relay-status ${device.relays.r1 === 'on' ? 'on' : 'off'}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${device.relays.r1 === 'on' ? 'AÃ§Ä±k' : 'KapalÄ±'}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="toggle-btn ${device.relays.r1 === 'on' ? 'on' : 'off'}"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onclick="toggleRelay('${device.id}', 'r1')">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="toggle-slider"></span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="relay-item">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="relay-info">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="relay-name">RÃ¶le 2</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="relay-status ${device.relays.r2 === 'on' ? 'on' : 'off'}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${device.relays.r2 === 'on' ? 'AÃ§Ä±k' : 'KapalÄ±'}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="toggle-btn ${device.relays.r2 === 'on' ? 'on' : 'off'}"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onclick="toggleRelay('${device.id}', 'r2')">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="toggle-slider"></span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="device-actions">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="action-btn btn-edit" onclick="editDevice('${device.id}')">DÃ¼zenle</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="action-btn btn-delete" onclick="deleteDevice('${device.id}')">Sil</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${device.ip ? `<button class="action-btn btn-check" onclick="checkDevice('${device.id}')">Durum</button>` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  container.innerHTML = html;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function addDevice() {
Â  Â  Â  Â  Â  Â  const name = document.getElementById('name').value.trim();
Â  Â  Â  Â  Â  Â  let mac = document.getElementById('mac').value.trim().toLowerCase();
Â  Â  Â  Â  Â  Â  const ip = document.getElementById('ip').value.trim();
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  mac = mac.replace(/:/g, '');
Â  Â  Â  Â  Â  Â  if (mac.length !== 12 || !/^[0-9a-f]{12}$/.test(mac)) {
Â  Â  Â  Â  Â  Â  Â  Â  showAlert('GeÃ§ersiz MAC adresi!', 'error');
Â  Â  Â  Â  Â  Â  Â  Â  return false;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const device = {
Â  Â  Â  Â  Â  Â  Â  Â  id: 'dev_' + Date.now(),
Â  Â  Â  Â  Â  Â  Â  Â  name: name,
Â  Â  Â  Â  Â  Â  Â  Â  mac: mac,
Â  Â  Â  Â  Â  Â  Â  Â  ip: ip || null,
Â  Â  Â  Â  Â  Â  Â  Â  relays: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  r1: 'off',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  r2: 'off'
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  devices.push(device);
Â  Â  Â  Â  Â  Â  saveDevices();
Â  Â  Â  Â  Â  Â  subscribeDevice(device);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  document.getElementById('addForm').reset();
Â  Â  Â  Â  Â  Â  renderDevices();
Â  Â  Â  Â  Â  Â  showTab('devices');
Â  Â  Â  Â  Â  Â  showAlert(`${name} eklendi`, 'success');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  return false;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function toggleRelay(deviceId, relay) {
Â  Â  Â  Â  Â  Â  const device = devices.find(d => d.id === deviceId);
Â  Â  Â  Â  Â  Â  if (!device || !device.mac || !mqttClient) return;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const currentState = device.relays[relay];
Â  Â  Â  Â  Â  Â  const newState = currentState === 'on' ? '0' : '1';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const topic = `esp01/${device.mac}/${relay}/set`;
Â  Â  Â  Â  Â  Â  mqttClient.publish(topic, newState, { qos: 0, retain: false });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  log(`${device.name} - ${relay}: ${currentState === 'on' ? 'KapandÄ±' : 'AÃ§Ä±ldÄ±'}`);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  device.relays[relay] = currentState === 'on' ? 'off' : 'on';
Â  Â  Â  Â  Â  Â  saveDevices();
Â  Â  Â  Â  Â  Â  renderDevices();
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  async function checkDevice(deviceId) {
Â  Â  Â  Â  Â  Â  const device = devices.find(d => d.id === deviceId);
Â  Â  Â  Â  Â  Â  if (!device || !device.ip) return;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  log(`${device.name} durum kontrolÃ¼...`);
Â  Â  Â  Â  Â  Â  Â  Â  showAlert('Durum kontrol ediliyor...', 'success');
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  log(`HTTP hatasÄ±: ${error.message}`);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function editDevice(deviceId) {
Â  Â  Â  Â  Â  Â  const device = devices.find(d => d.id === deviceId);
Â  Â  Â  Â  Â  Â  if (!device) return;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  document.getElementById('editId').value = device.id;
Â  Â  Â  Â  Â  Â  document.getElementById('editName').value = device.name;
Â  Â  Â  Â  Â  Â  document.getElementById('editMac').value = device.mac;
Â  Â  Â  Â  Â  Â  document.getElementById('editIp').value = device.ip || '';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  document.getElementById('editModal').style.display = 'flex';
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function saveEdit() {
Â  Â  Â  Â  Â  Â  const deviceId = document.getElementById('editId').value;
Â  Â  Â  Â  Â  Â  const device = devices.find(d => d.id === deviceId);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (!device) return;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (mqttClient && device.mac) {
Â  Â  Â  Â  Â  Â  Â  Â  const oldTopics = [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `esp01/${device.mac}/r1/state`,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `esp01/${device.mac}/r2/state`
Â  Â  Â  Â  Â  Â  Â  Â  ];
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  oldTopics.forEach(topic => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  mqttClient.unsubscribe(topic);
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  device.name = document.getElementById('editName').value.trim();
Â  Â  Â  Â  Â  Â  device.mac = document.getElementById('editMac').value.trim().toLowerCase();
Â  Â  Â  Â  Â  Â  device.ip = document.getElementById('editIp').value.trim() || null;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  subscribeDevice(device);
Â  Â  Â  Â  Â  Â  saveDevices();
Â  Â  Â  Â  Â  Â  renderDevices();
Â  Â  Â  Â  Â  Â  closeModal();
Â  Â  Â  Â  Â  Â  showAlert(`${device.name} gÃ¼ncellendi`, 'success');
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function closeModal() {
Â  Â  Â  Â  Â  Â  document.getElementById('editModal').style.display = 'none';
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function deleteDevice(deviceId) {
Â  Â  Â  Â  Â  Â  if (!confirm('CihazÄ± silmek istediÄŸinize emin misiniz?')) return;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const device = devices.find(d => d.id === deviceId);
Â  Â  Â  Â  Â  Â  const index = devices.findIndex(d => d.id === deviceId);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (index !== -1) {
Â  Â  Â  Â  Â  Â  Â  Â  if (mqttClient && device.mac) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const topics = [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `esp01/${device.mac}/r1/state`,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `esp01/${device.mac}/r2/state`
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  topics.forEach(topic => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  mqttClient.unsubscribe(topic);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  devices.splice(index, 1);
Â  Â  Â  Â  Â  Â  Â  Â  saveDevices();
Â  Â  Â  Â  Â  Â  Â  Â  renderDevices();
Â  Â  Â  Â  Â  Â  Â  Â  showAlert('Cihaz silindi', 'success');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function log(message) {
Â  Â  Â  Â  Â  Â  const logBox = document.getElementById('log');
Â  Â  Â  Â  Â  Â  const time = new Date().toLocaleTimeString();
Â  Â  Â  Â  Â  Â  logBox.innerHTML = `<div class="log-entry"><span class="log-time">[${time}]</span> ${message}</div>` + logBox.innerHTML;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (logBox.childNodes.length > 100) {
Â  Â  Â  Â  Â  Â  Â  Â  logBox.removeChild(logBox.lastChild);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function showAlert(message, type) {
Â  Â  Â  Â  Â  Â  const alertDiv = document.getElementById('alert');
Â  Â  Â  Â  Â  Â  alertDiv.textContent = message;
Â  Â  Â  Â  Â  Â  alertDiv.className = `alert ${type} show`;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  alertDiv.className = 'alert';
Â  Â  Â  Â  Â  Â  }, 3000);
Â  Â  Â  Â  }
Â  Â  </script>
</body>
</html>

arayÃ¼zÃ¼ deÄŸiÅŸtirme  kod gÃ¼zel ,
sadece butonlar toggle olmasÄ±n , tek buton on off ÅŸeklinde olsun .
