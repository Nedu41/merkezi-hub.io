<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Merkezi HUB Kontrol</title>
  <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; background: #121212; color: #eee; padding: 20px; margin: 0; }
    h1 { color: #03dac6; }
    .card { background: #1e1e1e; padding: 20px; margin: 15px auto; border-radius: 12px; max-width: 320px; box-shadow: 0 4px 8px rgba(0,0,0,0.5); }
    button { padding: 16px; font-size: 1.2em; margin: 8px; width: 100%; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; }
    .on { background: #03dac6; color: #000; }
    .off { background: #333; color: #ccc; border: 1px solid #444; }
    .status { margin: 12px 0; font-size: 1.1em; color: #bb86fc; }
    .loading { color: #ff9800; }
  </style>
</head>
<body>
  <h1>Merkezi HUB</h1>
  <p class="loading">BaÄŸlantÄ± kuruluyor...</p>

  <div class="card">
    <h3>RÃ¶le 1</h3>
    <button id="r1_on" class="on">AÃ‡IK</button>
    <button id="r1_off" class="off">KAPALI</button>
    <div class="status" id="r1_status">Durum: Bekleniyor...</div>
  </div>

  <div class="card">
    <h3>RÃ¶le 2</h3>
    <button id="r2_on" class="on">AÃ‡IK</button>
    <button id="r2_off" class="off">KAPALI</button>
    <div class="status" id="r2_status">Durum: Bekleniyor...</div>
  </div>

  <script>
    const client = mqtt.connect('wss://broker.hivemq.com:8084/mqtt');
    const loading = document.querySelector('.loading');

    client.on('connect', () => {
      loading.textContent = 'MQTT BaÄŸlandÄ±!';
      loading.style.color = '#4CAF50';
      client.subscribe('nejat/relay/1/state');
      client.subscribe('nejat/relay/2/state');
    });

    client.on('message', (topic, message) => {
      const state = message.toString();
      if (topic === 'nejat/relay/1/state') {
        document.getElementById('r1_status').innerText = `Durum: ${state === '1' ? 'AÃ‡IK ðŸŸ¢' : 'KAPALI ðŸ”´'}`;
      }
      if (topic === 'nejat/relay/2/state') {
        document.getElementById('r2_status').innerText = `Durum: ${state === '1' ? 'AÃ‡IK ðŸŸ¢' : 'KAPALI ðŸ”´'}`;
      }
    });

    client.on('error', () => {
      loading.textContent = 'MQTT BaÄŸlantÄ± HatasÄ±!';
      loading.style.color = '#cf6679';
    });

    function send(relay, state) {
      client.publish(`nejat/relay/${relay}/set`, state);
    }

    document.getElementById('r1_on').onclick = () => send(1, '1');
    document.getElementById('r1_off').onclick = () => send(1, '0');
    document.getElementById('r2_on').onclick = () => send(2, '1');
    document.getElementById('r2_off').onclick = () => send(2, '0');
  </script>
</body>
</html>
