<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>MQTT R√∂le Kontrol Paneli</title>

<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>

<style>
body{background:#121212;color:#eee;font-family:Segoe UI;margin:0}
.header{background:#1f1f1f;padding:12px;text-align:center;font-weight:bold;color:#03dac6}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:10px;padding:10px}
.card{background:#1e1e1e;border-radius:10px;padding:12px;border:1px solid #333}
.title{display:flex;justify-content:space-between;align-items:center}
.dot{width:10px;height:10px;border-radius:50%}
.on{background:#4CAF50}
.off{background:#cf6679}
button{width:100%;padding:10px;margin-top:8px;font-size:14px;border:none;border-radius:6px}
.btn-on{background:#03dac6;color:#000}
.btn-off{background:#333;color:#fff}
input{width:100%;padding:6px;background:#111;color:#fff;border:1px solid #333;border-radius:4px}
</style>
</head>

<body>

<div class="header">üåê MQTT R√∂le Kontrol</div>

<div style="padding:10px">
<input id="broker" value="wss://broker.hivemq.com:8884/mqtt">
<input id="mac" placeholder="ESP01 MAC (√∂r: a1b2c3d4e5f6)">
<button onclick="connect()">üîå MQTT Baƒülan</button>
</div>

<div class="grid" id="cards"></div>

<script>
let client;
let mac="";
let states={1:"0",2:"0"};

function connect(){
 mac=document.getElementById("mac").value.trim();
 if(!mac){alert("MAC gir");return;}

 client=mqtt.connect(document.getElementById("broker").value);

 client.on("connect",()=>{
   subscribe(1);
   subscribe(2);
   render();
 });

 client.on("message",(t,p)=>{
   const r=t.includes("/r1/")?1:2;
   states[r]=p.toString();
   update(r);
 });
}

function topic(r,type){
 return `esp01/${mac}/r${r}/${type}`;
}

function subscribe(r){
 client.subscribe(topic(r,"state"));
}

function publish(r,val){
 client.publish(topic(r,"set"),val,{retain:true});
}

function render(){
 document.getElementById("cards").innerHTML=`
 <div class="card">
   <div class="title">
     <b>R√∂le 1</b><div id="d1" class="dot off"></div>
   </div>
   <button id="b1" class="btn-off" onclick="toggle(1)">...</button>
 </div>

 <div class="card">
   <div class="title">
     <b>R√∂le 2</b><div id="d2" class="dot off"></div>
   </div>
   <button id="b2" class="btn-off" onclick="toggle(2)">...</button>
 </div>`;
}

function toggle(r){
 publish(r, states[r]==="1"?"0":"1");
}

function update(r){
 const on=states[r]==="1";
 document.getElementById("b"+r).textContent=on?"‚úÖ A√áIK":"‚≠ï KAPALI";
 document.getElementById("b"+r).className=on?"btn-on":"btn-off";
 document.getElementById("d"+r).className="dot "+(on?"on":"off");
}
</script>

</body>
</html>
